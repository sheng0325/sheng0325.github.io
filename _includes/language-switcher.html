<div class="language-switcher">
  <a href="/en/" class="language-link" id="lang-en-link">EN</a>
  <span class="language-sep">/</span>
  <a href="/" class="language-link" id="lang-zh-link">中文</a>
</div>

<script>
(function() {
  'use strict';

  // 获取当前页面语言
  function getCurrentLanguage() {
    const path = window.location.pathname;
    if (path.startsWith('/en/') || path === '/en') {
      return 'en';
    } else {
      return 'zh';
    }
  }

  // 获取当前页面在另一种语言中的对应路径
  function getAlternatePath() {
    const path = window.location.pathname;
    const currentLang = getCurrentLanguage();

    // 移除末尾斜杠（如果有）
    const cleanPath = path.endsWith('/') ? path.slice(0, -1) : path;

    if (currentLang === 'en') {
      // 英文 -> 中文
      if (cleanPath === '/en' || cleanPath === '') {
        return '/';
      } else if (cleanPath.startsWith('/en/projects')) {
        return '/projects/';
      } else if (cleanPath.startsWith('/en/competitions')) {
        return '/competitions/';
      } else {
        // 移除 /en 前缀
        return cleanPath.replace('/en', '') || '/';
      }
    } else {
      // 中文 -> 英文
      if (cleanPath === '/' || cleanPath === '') {
        return '/en/';
      } else if (cleanPath.startsWith('/projects')) {
        return '/en/projects/';
      } else if (cleanPath.startsWith('/competitions')) {
        return '/en/competitions/';
      } else {
        return '/en' + cleanPath;
      }
    }
  }

  // 初始化语言切换器
  function initLanguageSwitcher() {
    const currentLang = getCurrentLanguage();
    const enLink = document.getElementById('lang-en-link');
    const zhLink = document.getElementById('lang-zh-link');

    if (!enLink || !zhLink) {
      console.warn('Language switcher links not found');
      return;
    }

    // 设置按钮状态和链接
    if (currentLang === 'en') {
      enLink.classList.add('active');
      zhLink.classList.remove('active');
      zhLink.href = getAlternatePath();
    } else {
      zhLink.classList.add('active');
      enLink.classList.remove('active');
      enLink.href = getAlternatePath();
    }

    console.log('Language switcher initialized. Current language:', currentLang);
  }

  // 更新导航菜单文本和链接
  function updateNavigationMenu(currentLang) {
    const navLinks = document.querySelectorAll('.masthead__menu-item a:not(.language-link)');
    const navData = currentLang === 'en' ? [
      { title: 'About', url: '/en/' },
      { title: 'Projects', url: '/en/projects/' },
      { title: 'Honors & Awards', url: '/en/competitions/' }
    ] : [
      { title: '个人信息', url: '/' },
      { title: '项目', url: '/projects/' },
      { title: '荣誉奖项', url: '/competitions/' }
    ];

    // 更新前3个导航链接（排除语言切换器）
    navLinks.forEach((link, index) => {
      if (index < navData.length && navData[index]) {
        link.textContent = navData[index].title;
        link.href = navData[index].url;
      }
    });

    console.log('Navigation menu updated for language:', currentLang);
  }

  // 初始化语言切换器
  function initLanguageSwitcher() {
    const currentLang = getCurrentLanguage();
    const enLink = document.getElementById('lang-en-link');
    const zhLink = document.getElementById('lang-zh-link');

    if (!enLink || !zhLink) {
      console.warn('Language switcher links not found');
      return;
    }

    // 设置按钮状态和链接
    if (currentLang === 'en') {
      enLink.classList.add('active');
      zhLink.classList.remove('active');
      zhLink.href = getAlternatePath();
    } else {
      zhLink.classList.add('active');
      enLink.classList.remove('active');
      enLink.href = getAlternatePath();
    }

    // 更新导航菜单
    updateNavigationMenu(currentLang);

    console.log('Language switcher initialized. Current language:', currentLang);
  }

  // 页面加载完成后立即初始化
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLanguageSwitcher);
  } else {
    initLanguageSwitcher();
  }
})();
</script>

<style>
.language-switcher {
  display: flex;
  align-items: center;
}

.language-link {
  text-decoration: none;
  color: inherit;
  font-weight: inherit;
}

.language-link.active {
  font-weight: 600;
  pointer-events: none;
}

.language-sep {
  margin: 0 0.25rem;
  color: inherit;
}
</style>
