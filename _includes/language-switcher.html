<div class="language-switcher-wrapper">
  <div class="language-switcher">
    <a href="/en/" class="lang-btn" id="lang-en-link">
      <span class="lang-icon">ğŸŒ</span>
      <span class="lang-text">EN</span>
    </a>
    <a href="/" class="lang-btn" id="lang-zh-link">
      <span class="lang-icon">ğŸ‡¨ğŸ‡³</span>
      <span class="lang-text">ä¸­æ–‡</span>
    </a>
  </div>
</div>

<script>
(function() {
  'use strict';

  // è·å–å½“å‰é¡µé¢è¯­è¨€
  function getCurrentLanguage() {
    const path = window.location.pathname;
    if (path.startsWith('/en/') || path === '/en' || path.endsWith('/en/')) {
      return 'en';
    } else {
      return 'zh';
    }
  }

  // è·å–å½“å‰é¡µé¢åœ¨å¦ä¸€ç§è¯­è¨€ä¸­çš„å¯¹åº”è·¯å¾„
  function getAlternatePath() {
    const path = window.location.pathname;
    const currentLang = getCurrentLanguage();

    // ç§»é™¤æœ«å°¾æ–œæ ï¼ˆå¦‚æœæœ‰ï¼‰
    const cleanPath = path.endsWith('/') ? path.slice(0, -1) : path;

    if (currentLang === 'en') {
      // è‹±æ–‡ -> ä¸­æ–‡
      if (cleanPath === '/en' || cleanPath === '' || cleanPath === '/') {
        return '/';
      } else if (cleanPath.startsWith('/en/projects')) {
        return '/projects/';
      } else if (cleanPath.startsWith('/en/competitions')) {
        return '/competitions/';
      } else {
        // ç§»é™¤ /en å‰ç¼€
        return cleanPath.replace('/en', '') || '/';
      }
    } else {
      // ä¸­æ–‡ -> è‹±æ–‡
      if (cleanPath === '/' || cleanPath === '') {
        return '/en/';
      } else if (cleanPath.startsWith('/projects')) {
        return '/en/projects/';
      } else if (cleanPath.startsWith('/competitions')) {
        return '/en/competitions/';
      } else {
        return '/en' + cleanPath;
      }
    }
  }

  // åˆå§‹åŒ–è¯­è¨€åˆ‡æ¢å™¨
  function initLanguageSwitcher() {
    const currentLang = getCurrentLanguage();
    const enLink = document.getElementById('lang-en-link');
    const zhLink = document.getElementById('lang-zh-link');

    if (!enLink || !zhLink) {
      console.warn('Language switcher links not found');
      return;
    }

    // è®¾ç½®æŒ‰é’®çŠ¶æ€
    if (currentLang === 'en') {
      enLink.classList.add('active');
      zhLink.classList.remove('active');
      // è‹±æ–‡é¡µé¢æ—¶ï¼Œä¸­æ–‡æŒ‰é’®åº”è¯¥é“¾æ¥åˆ°å¯¹åº”çš„ä¸­æ–‡é¡µé¢
      zhLink.href = getAlternatePath();
    } else {
      zhLink.classList.add('active');
      enLink.classList.remove('active');
      // ä¸­æ–‡é¡µé¢æ—¶ï¼Œè‹±æ–‡æŒ‰é’®åº”è¯¥é“¾æ¥åˆ°å¯¹åº”çš„è‹±æ–‡é¡µé¢
      enLink.href = getAlternatePath();
    }

    console.log('Language switcher initialized. Current language:', currentLang);
    console.log('EN link:', enLink.href);
    console.log('ZH link:', zhLink.href);
  }

  // é¡µé¢åŠ è½½å®Œæˆåç«‹å³åˆå§‹åŒ–
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLanguageSwitcher);
  } else {
    initLanguageSwitcher();
  }
})();
</script>

<style>
.language-switcher-wrapper {
  position: fixed;
  top: 0.5rem;
  right: 2rem;
  z-index: 1000;
}

.language-switcher {
  display: flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.35rem 0.6rem;
  background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
  border-radius: 20px;
  border: 1px solid #d8b4fe;
  box-shadow: 0 2px 8px rgba(102, 8, 116, 0.1);
  transition: all 0.3s ease;
}

.language-switcher:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(102, 8, 116, 0.2);
  border-color: #c084fc;
}

.lang-btn {
  color: #660874;
  text-decoration: none;
  font-size: 0.85rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 0.35rem;
  padding: 0.35rem 0.6rem;
  border-radius: 14px;
  transition: all 0.3s ease;
  cursor: pointer;
  border: none;
  background: transparent;
}

.lang-btn:hover:not(.active) {
  background: rgba(102, 8, 116, 0.1);
  transform: scale(1.05);
}

.lang-btn.active {
  background: #660874;
  color: #ffffff;
  box-shadow: 0 2px 6px rgba(102, 8, 116, 0.3);
  cursor: default;
  pointer-events: none;
}

.lang-btn.active:hover {
  transform: none;
  background: #660874;
}

.lang-icon {
  font-size: 1rem;
  line-height: 1;
}

.lang-text {
  font-size: 0.85rem;
  font-weight: 600;
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
  .language-switcher-wrapper {
    top: 0.3rem;
    right: 1rem;
  }

  .lang-text {
    display: none;
  }

  .language-switcher {
    padding: 0.4rem;
  }

  .lang-btn {
    padding: 0.4rem;
  }
}
</style>
